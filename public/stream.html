<!DOCTYPE html>
<html>
    <head>
        <title>Zego Viewer</title>
        <!-- Correct SDK path (adjust as needed) -->
        <script src="https://zegocloud.github.io/zego-express-webrtc-sdk/webrtc/ZegoExpressEngine.min.js"></script>
    </head>
    <body>
        <h2>Zego Viewer</h2>
        <div
            id="video-container"
            style="width: 640px; height: 360px; background: #ddd"
        ></div>
        <button onclick="startViewing()">Start Watching</button>

        <script>
            async function startViewing() {
                try {
                    const res = await fetch("/stream-info");
                    const data = await res.json();

                    // Check if SDK is properly loaded
                    if (!window.ZegoExpressEngine) {
                        throw new Error("Zego SDK not loaded");
                    }

                    const zg = new ZegoExpressEngine(data.appID, data.appSign);

                    // Add event listeners
                    zg.on('roomStreamUpdate', (roomID, updateType, streamList) => {
                        console.log('Stream update:', updateType, streamList);
                        if (updateType === 'ADD' && streamList.length > 0) {
                            const streamID = streamList[0].streamID;
                            playStream(zg, streamID);
                        }
                    });

                    await zg.loginRoom(data.roomID, 1, {
                        userID: data.userID,
                        userName: data.userName,
                    });

                    console.log("✅ Successfully joined room");
                    
                } catch (error) {
                    console.error("Error:", error);
                    alert("Error: " + error.message);
                }
            }

            function playStream(zg, streamID) {
                const container = document.getElementById("video-container");
                zg.startPlayingStream(streamID, { 
                    container: container,
                    muted: true,
                });
                console.log("✅ Playing stream:", streamID);
            }
        </script>
    </body>
</html>