<!DOCTYPE html>
<html>
<head>
    <title>Zego Viewer</title>
    <style>
        body { font-family: Arial; text-align: center; padding: 20px; }
        #video-container { 
            width: 640px; height: 360px; 
            background: black; margin: 20px auto;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #status {
            margin: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .error { background: #FFEBEE; color: #D32F2F; }
        .success { background: #E8F5E9; color: #388E3C; }
    </style>
</head>
<body>
    <h1>Zego Viewer</h1>
    <div id="video-container">Stream yahan ayega</div>
    <button id="watchBtn" disabled>Start Watching</button>
    <div id="status">Loading SDK...</div>

    <script>
    // Configuration
    const config = {
        appID: 1173379578,
        appSign: "7094b1463e589f6c10d756d00a89648263426a00d725a02aadfb89dc553dc458",
        roomID: "streaming_001",
        userID: "viewer_" + Math.floor(Math.random() * 10000),
        userName: "Viewer_" + Math.floor(Math.random() * 100)
    };

    const statusEl = document.getElementById('status');
    const watchBtn = document.getElementById('watchBtn');
    let zg = null;

    function updateStatus(message, isError = false) {
        statusEl.textContent = message;
        statusEl.className = isError ? 'error' : 'success';
        console.log(message);
    }

    // SDK load karne ka best tareeka
    async function loadSDK() {
        return new Promise((resolve) => {
            // Pehla try - Official Zego CDN
            const script1 = document.createElement('script');
            script1.src = "https://storage.zego.im/sdk/rtc/ZegoExpressEngine.min.js";
            script1.onload = () => resolve(true);
            script1.onerror = () => {
                // Agar fail ho to dusra CDN try karein
                const script2 = document.createElement('script');
                script2.src = "https://cdn.jsdelivr.net/npm/zego-express-engine-webrtc@latest/sdk/ZegoExpressEngine.min.js";
                script2.onload = () => resolve(true);
                script2.onerror = () => resolve(false);
                document.head.appendChild(script2);
            };
            document.head.appendChild(script1);
        });
    }

    async function initialize() {
        try {
            // 1. SDK load karein
            updateStatus("SDK load ho raha hai...");
            const sdkLoaded = await loadSDK();
            
            if (!sdkLoaded || !window.ZegoExpressEngine) {
                throw new Error("SDK load nahi hua. Kya aapka internet chal raha hai?");
            }
            
            updateStatus("SDK successfully load ho gaya");
            
            // 2. Zego engine start karein
            zg = new ZegoExpressEngine(config.appID, config.appSign);
            
            // 3. Stream updates ka intezaam
            zg.on('roomStreamUpdate', (roomID, updateType, streamList) => {
                if (updateType === 'ADD' && streamList.length > 0) {
                    playStream(streamList[0].streamID);
                }
            });
            
            watchBtn.disabled = false;
            updateStatus("Ready to watch");
            
        } catch (error) {
            updateStatus(`Error: ${error.message}`, true);
            watchBtn.disabled = true;
        }
    }

    async function startViewing() {
        try {
            watchBtn.disabled = true;
            updateStatus("Room mein join ho raha hoon...");
            
            await zg.loginRoom(config.roomID, 1, {
                userID: config.userID,
                userName: config.userName
            });
            
            updateStatus(`Room ${config.roomID} mein join ho gaya`);
            
        } catch (error) {
            updateStatus(`Error: ${error.message}`, true);
            watchBtn.disabled = false;
        }
    }

    async function playStream(streamID) {
        try {
            const container = document.getElementById('video-container');
            await zg.startPlayingStream(streamID, {
                container: container,
                video: true,
                audio: true
            });
            updateStatus(`Ab play ho raha hai: ${streamID}`);
        } catch (error) {
            updateStatus(`Play nahi ho paaya: ${error.message}`, true);
        }
    }

    // Page load hone par initialize karein
    window.addEventListener('DOMContentLoaded', initialize);
    watchBtn.addEventListener('click', startViewing);
    </script>
</body>
</html>