<!DOCTYPE html>
<html>
<head>
    <title>Zego Viewer</title>
    <script src="public/dist_js/ZegoExpressWebRTC-3.9.0.js"></script>
    <style>
        #video-container {
            width: 100%;
            max-width: 640px;
            height: 360px;
            background: #333;
            margin: 20px auto;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #0066ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 0 auto;
        }
        .status {
            text-align: center;
            margin: 10px;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <h2 style="text-align:center">Zego Live Stream Viewer</h2>
    <div id="video-container"></div>
    <p class="status" id="status">Ready to connect...</p>
    <button onclick="startViewing()">Start Watching Live-001</button>

    <script>
        // ZEGO Credentials (same as your backend)
        const APP_ID = 1173379578;
        const APP_SIGN = "7094b1463e589f6c10d756d00a89648263426a00d725a02aadfb89dc553dc458";
        
        // Stream details from app developer
        const ROOM_ID = "Live-001";  // Must match publisher's room ID
        const STREAM_ID = "streaming_001"; // Must match publisher's stream ID

        async function startViewing() {
            try {
                document.getElementById('status').textContent = "Connecting...";
                
                // 1. Initialize Zego SDK
                const zg = new ZegoExpressEngine(APP_ID, APP_SIGN);
                
                // 2. Enable debug logs
                zg.setLogConfig({ logLevel: 'debug' });
                console.log("SDK initialized");

                // 3. Login to room (using random user ID)
                const randomUserID = "viewer_" + Math.floor(Math.random() * 10000);
                await zg.loginRoom(ROOM_ID, null, {  // null token for testing
                    userID: randomUserID,
                    userName: "Viewer_" + randomUserID
                });
                console.log("Logged in to room:", ROOM_ID);

                // 4. Start playing stream
                const container = document.getElementById("video-container");
                const playResult = await zg.startPlayingStream(STREAM_ID, {
                    container: container,
                    video: true,
                    audio: true
                });
                
                document.getElementById('status').textContent = "Watching Live Stream!";
                console.log("Playing stream:", STREAM_ID, playResult);

                // Handle stream events
                zg.on("playerStateUpdate", (result) => {
                    console.log("Stream state:", result.state);
                    if (result.state === "NO_PLAY") {
                        document.getElementById('status').textContent = "Stream disconnected";
                    }
                });

            } catch (error) {
                console.error("Error:", error);
                document.getElementById('status').textContent = "Error: " + 
                    (error.message || "Failed to connect");
                alert("Error: " + (error.message || "Check console for details"));
            }
        }
    </script>
</body>
</html>